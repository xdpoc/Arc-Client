--[[
    ARC CLIENT | ARSENAL EDITION
    Developed by mqp6/developer
    Build: 10.1.0-arsenal-custom-fixed
    STATUS: READONLY TABLE FIXED - UI LOADS NOW
]]

-- ============================================
-- SERVICES
-- ============================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInput = game:GetService("VirtualInputManager")
local StarterGui = game:GetService("StarterGui")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

-- Camera & LocalPlayer
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Arsenal Detection
if game.PlaceId ~= 286090429 and game.PlaceId ~= 296077173 and game.PlaceId ~= 3429889639 then
    StarterGui:SetCore("SendNotification", {
        Title = "ARC CLIENT",
        Text = "This script is for ARSENAL only!",
        Duration = 5
    })
    return
end

-- ============================================
-- FIX: METATABLE HANDLING (READONLY FIX)
-- ============================================
local mt = nil
local oldNamecall = nil
local oldIndex = nil
local success, result = pcall(function()
    mt = getrawmetatable(game)
    oldNamecall = mt.__namecall
    oldIndex = mt.__index
    setreadonly(mt, false)
    return true
end)

if not success then
    warn("ARC CLIENT: Could not hook metatable, silent aim will not work")
end

-- ============================================
-- CUSTOM UI SYSTEM (SIMPLIFIED - 100% WORKS)
-- ============================================
local ArcUI = {}
ArcUI.Flags = {}

-- Colors
local Colors = {
    Background = Color3.fromRGB(20, 20, 25),
    Surface = Color3.fromRGB(30, 30, 35),
    Element = Color3.fromRGB(40, 40, 45),
    ElementHover = Color3.fromRGB(50, 50, 55),
    ElementActive = Color3.fromRGB(60, 60, 70),
    Accent = Color3.fromRGB(0, 120, 255),
    AccentHover = Color3.fromRGB(30, 150, 255),
    Success = Color3.fromRGB(40, 200, 80),
    Danger = Color3.fromRGB(255, 80, 80),
    Text = Color3.fromRGB(255, 255, 255),
    TextDim = Color3.fromRGB(180, 180, 180),
    Border = Color3.fromRGB(60, 60, 70)
}

-- Create main ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ArcClientUI"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Window Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 750, 0, 500)
MainFrame.Position = UDim2.new(0.5, -375, 0.5, -250)
MainFrame.BackgroundColor3 = Colors.Background
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

-- Rounded corners
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Shadow
local Shadow = Instance.new("ImageLabel")
Shadow.Name = "Shadow"
Shadow.Size = UDim2.new(1, 30, 1, 30)
Shadow.Position = UDim2.new(0, -15, 0, -15)
Shadow.BackgroundTransparency = 1
Shadow.Image = "rbxassetid://6014261993"
Shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
Shadow.ImageTransparency = 0.7
Shadow.ScaleType = Enum.ScaleType.Slice
Shadow.SliceCenter = Rect.new(10, 10, 10, 10)
Shadow.Parent = MainFrame
Shadow.ZIndex = -1

-- Stroke
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Colors.Border
UIStroke.Thickness = 1
UIStroke.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 45)
TitleBar.BackgroundColor3 = Colors.Surface
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -50, 1, 0)
TitleLabel.Position = UDim2.new(0, 15, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "ARC CLIENT | ARSENAL"
TitleLabel.TextColor3 = Colors.Text
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.TextSize = 18
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Parent = TitleBar

local VersionLabel = Instance.new("TextLabel")
VersionLabel.Size = UDim2.new(0, 60, 1, 0)
VersionLabel.Position = UDim2.new(1, -70, 0, 0)
VersionLabel.BackgroundTransparency = 1
VersionLabel.Text = "v10.1"
VersionLabel.TextColor3 = Colors.TextDim
VersionLabel.TextSize = 14
VersionLabel.Font = Enum.Font.Gotham
VersionLabel.Parent = TitleBar

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -40, 0.5, -15)
CloseButton.BackgroundColor3 = Colors.Element
CloseButton.Text = "✕"
CloseButton.TextColor3 = Colors.TextDim
CloseButton.TextSize = 16
CloseButton.Font = Enum.Font.GothamBold
CloseButton.AutoButtonColor = false
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

CloseButton.MouseEnter:Connect(function()
    CloseButton.BackgroundColor3 = Colors.Danger
    CloseButton.TextColor3 = Colors.Text
end)

CloseButton.MouseLeave:Connect(function()
    CloseButton.BackgroundColor3 = Colors.Element
    CloseButton.TextColor3 = Colors.TextDim
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Dragging
local dragging = false
local dragInput, dragStart, startPos

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Tab Container
local TabContainer = Instance.new("Frame")
TabContainer.Name = "TabContainer"
TabContainer.Size = UDim2.new(1, -20, 0, 45)
TabContainer.Position = UDim2.new(0, 10, 0, 55)
TabContainer.BackgroundColor3 = Colors.Surface
TabContainer.BorderSizePixel = 0
TabContainer.Parent = MainFrame

local TabCorner = Instance.new("UICorner")
TabCorner.CornerRadius = UDim.new(0, 8)
TabCorner.Parent = TabContainer

local TabListLayout = Instance.new("UIListLayout")
TabListLayout.FillDirection = Enum.FillDirection.Horizontal
TabListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
TabListLayout.VerticalAlignment = Enum.VerticalAlignment.Center
TabListLayout.Padding = UDim.new(0, 5)
TabListLayout.Parent = TabContainer

local TabPadding = Instance.new("UIPadding")
TabPadding.PaddingLeft = UDim.new(0, 10)
TabPadding.PaddingRight = UDim.new(0, 10)
TabPadding.Parent = TabContainer

-- Content Container
local ContentContainer = Instance.new("Frame")
ContentContainer.Name = "ContentContainer"
ContentContainer.Size = UDim2.new(1, -20, 1, -120)
ContentContainer.Position = UDim2.new(0, 10, 0, 110)
ContentContainer.BackgroundColor3 = Colors.Surface
ContentContainer.BorderSizePixel = 0
ContentContainer.Parent = MainFrame

local ContentCorner = Instance.new("UICorner")
ContentCorner.CornerRadius = UDim.new(0, 8)
ContentCorner.Parent = ContentContainer

local ContentPadding = Instance.new("UIPadding")
ContentPadding.PaddingLeft = UDim.new(0, 15)
ContentPadding.PaddingRight = UDim.new(0, 15)
ContentPadding.PaddingTop = UDim.new(0, 15)
ContentPadding.PaddingBottom = UDim.new(0, 15)
ContentPadding.Parent = ContentContainer

local ContentListLayout = Instance.new("UIListLayout")
ContentListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ContentListLayout.Padding = UDim.new(0, 15)
ContentListLayout.Parent = ContentContainer

-- ============================================
-- TAB SYSTEM
-- ============================================
local Tabs = {}
local TabButtons = {}
local TabContents = {}

local function CreateTab(name)
    local TabButton = Instance.new("TextButton")
    TabButton.Name = name .. "Tab"
    TabButton.Size = UDim2.new(0, 0, 0, 30)
    TabButton.AutomaticSize = Enum.AutomaticSize.X
    TabButton.BackgroundColor3 = Colors.Element
    TabButton.Text = "   " .. name .. "   "
    TabButton.TextColor3 = Colors.TextDim
    TabButton.TextSize = 14
    TabButton.Font = Enum.Font.Gotham
    TabButton.AutoButtonColor = false
    TabButton.Parent = TabContainer
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 6)
    ButtonCorner.Parent = TabButton
    
    local TabContent = Instance.new("ScrollingFrame")
    TabContent.Name = name .. "Content"
    TabContent.Size = UDim2.new(1, 0, 1, 0)
    TabContent.BackgroundColor3 = Colors.Surface
    TabContent.BackgroundTransparency = 1
    TabContent.BorderSizePixel = 0
    TabContent.ScrollBarThickness = 4
    TabContent.ScrollBarImageColor3 = Colors.Accent
    TabContent.CanvasSize = UDim2.new(0, 0, 0, 0)
    TabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    TabContent.Visible = false
    TabContent.Parent = ContentContainer
    
    local ContentLayout = Instance.new("UIListLayout")
    ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ContentLayout.Padding = UDim.new(0, 15)
    ContentLayout.Parent = TabContent
    
    ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        TabContent.CanvasSize = UDim2.new(0, 0, 0, ContentLayout.AbsoluteContentSize.Y + 30)
    end)
    
    local Padding = Instance.new("UIPadding")
    Padding.PaddingLeft = UDim.new(0, 5)
    Padding.PaddingRight = UDim.new(0, 5)
    Padding.PaddingTop = UDim.new(0, 5)
    Padding.PaddingBottom = UDim.new(0, 5)
    Padding.Parent = TabContent
    
    table.insert(TabButtons, TabButton)
    table.insert(TabContents, TabContent)
    Tabs[name] = TabContent
    
    return TabContent, ContentLayout
end

-- Tab switching
local function SwitchTab(index)
    for i, btn in ipairs(TabButtons) do
        btn.BackgroundColor3 = Colors.Element
        btn.TextColor3 = Colors.TextDim
    end
    for i, content in ipairs(TabContents) do
        content.Visible = false
    end
    TabButtons[index].BackgroundColor3 = Colors.Accent
    TabButtons[index].TextColor3 = Colors.Text
    TabContents[index].Visible = true
end

-- ============================================
-- UI ELEMENTS
-- ============================================
local function CreateSection(parent, title)
    local Section = Instance.new("Frame")
    Section.Name = title .. "Section"
    Section.Size = UDim2.new(1, 0, 0, 0)
    Section.AutomaticSize = Enum.AutomaticSize.Y
    Section.BackgroundColor3 = Colors.Element
    Section.BorderSizePixel = 0
    Section.Parent = parent
    
    local SectionCorner = Instance.new("UICorner")
    SectionCorner.CornerRadius = UDim.new(0, 8)
    SectionCorner.Parent = Section
    
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 35)
    TitleBar.BackgroundColor3 = Colors.ElementHover
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = Section
    
    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 8)
    TitleCorner.Parent = TitleBar
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -20, 1, 0)
    TitleLabel.Position = UDim2.new(0, 15, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Colors.Text
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.TextSize = 15
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.Parent = TitleBar
    
    local Content = Instance.new("Frame")
    Content.Name = "Content"
    Content.Size = UDim2.new(1, -20, 0, 0)
    Content.Position = UDim2.new(0, 10, 0, 45)
    Content.BackgroundTransparency = 1
    Content.AutomaticSize = Enum.AutomaticSize.Y
    Content.Parent = Section
    
    local ContentLayout = Instance.new("UIListLayout")
    ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ContentLayout.Padding = UDim.new(0, 10)
    ContentLayout.Parent = Content
    
    local Padding = Instance.new("UIPadding")
    Padding.PaddingBottom = UDim.new(0, 15)
    Padding.Parent = Section
    
    return Content, ContentLayout
end

local function CreateToggle(parent, name, default, callback)
    local Frame = Instance.new("Frame")
    Frame.Name = name .. "Toggle"
    Frame.Size = UDim2.new(1, 0, 0, 35)
    Frame.BackgroundColor3 = Colors.Element
    Frame.BorderSizePixel = 0
    Frame.Parent = parent
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 6)
    Corner.Parent = Frame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -50, 1, 0)
    Label.Position = UDim2.new(0, 15, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Colors.Text
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.TextSize = 14
    Label.Font = Enum.Font.Gotham
    Label.Parent = Frame
    
    local ToggleBg = Instance.new("Frame")
    ToggleBg.Name = "ToggleBg"
    ToggleBg.Size = UDim2.new(0, 50, 0, 24)
    ToggleBg.Position = UDim2.new(1, -60, 0.5, -12)
    ToggleBg.BackgroundColor3 = default and Colors.Success or Colors.ElementHover
    ToggleBg.BorderSizePixel = 0
    ToggleBg.Parent = Frame
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(1, 0)
    ToggleCorner.Parent = ToggleBg
    
    local Indicator = Instance.new("Frame")
    Indicator.Name = "Indicator"
    Indicator.Size = UDim2.new(0, 20, 0, 20)
    Indicator.Position = default and UDim2.new(1, -24, 0.5, -10) or UDim2.new(0, 4, 0.5, -10)
    Indicator.BackgroundColor3 = Colors.Text
    Indicator.BorderSizePixel = 0
    Indicator.Parent = ToggleBg
    
    local IndicatorCorner = Instance.new("UICorner")
    IndicatorCorner.CornerRadius = UDim.new(1, 0)
    IndicatorCorner.Parent = Indicator
    
    local Button = Instance.new("TextButton")
    Button.Name = "Button"
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""
    Button.Parent = Frame
    
    local value = default
    
    Button.MouseButton1Click:Connect(function()
        value = not value
        ToggleBg.BackgroundColor3 = value and Colors.Success or Colors.ElementHover
        Indicator:TweenPosition(
            value and UDim2.new(1, -24, 0.5, -10) or UDim2.new(0, 4, 0.5, -10),
            Enum.EasingDirection.Out,
            Enum.EasingStyle.Quad,
            0.2,
            true
        )
        if callback then callback(value) end
    end)
    
    return Frame
end

local function CreateSlider(parent, name, min, max, default, suffix, callback)
    local Frame = Instance.new("Frame")
    Frame.Name = name .. "Slider"
    Frame.Size = UDim2.new(1, 0, 0, 55)
    Frame.BackgroundColor3 = Colors.Element
    Frame.BorderSizePixel = 0
    Frame.Parent = parent
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 6)
    Corner.Parent = Frame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.5, 0, 0, 20)
    Label.Position = UDim2.new(0, 15, 0, 10)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Colors.Text
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.TextSize = 14
    Label.Font = Enum.Font.Gotham
    Label.Parent = Frame
    
    local ValueLabel = Instance.new("TextLabel")
    ValueLabel.Name = "Value"
    ValueLabel.Size = UDim2.new(0.5, -15, 0, 20)
    ValueLabel.Position = UDim2.new(0.5, 0, 0, 10)
    ValueLabel.BackgroundTransparency = 1
    ValueLabel.Text = tostring(default) .. (suffix or "")
    ValueLabel.TextColor3 = Colors.Accent
    ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
    ValueLabel.TextSize = 14
    ValueLabel.Font = Enum.Font.GothamBold
    ValueLabel.Parent = Frame
    
    local SliderBg = Instance.new("Frame")
    SliderBg.Name = "SliderBg"
    SliderBg.Size = UDim2.new(1, -30, 0, 8)
    SliderBg.Position = UDim2.new(0, 15, 0, 35)
    SliderBg.BackgroundColor3 = Colors.ElementHover
    SliderBg.BorderSizePixel = 0
    SliderBg.Parent = Frame
    
    local SliderBgCorner = Instance.new("UICorner")
    SliderBgCorner.CornerRadius = UDim.new(1, 0)
    SliderBgCorner.Parent = SliderBg
    
    local SliderFill = Instance.new("Frame")
    SliderFill.Name = "SliderFill"
    SliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    SliderFill.BackgroundColor3 = Colors.Accent
    SliderFill.BorderSizePixel = 0
    SliderFill.Parent = SliderBg
    
    local SliderFillCorner = Instance.new("UICorner")
    SliderFillCorner.CornerRadius = UDim.new(1, 0)
    SliderFillCorner.Parent = SliderFill
    
    local Button = Instance.new("TextButton")
    Button.Name = "Button"
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""
    Button.Parent = Frame
    
    local dragging = false
    local value = default
    
    local function updateSlider(input)
        local pos = input.Position.X
        local absPos = SliderBg.AbsolutePosition.X
        local absSize = SliderBg.AbsoluteSize.X
        
        local percent = math.clamp((pos - absPos) / absSize, 0, 1)
        local newValue = math.floor((min + (max - min) * percent) * 100) / 100
        newValue = math.clamp(newValue, min, max)
        
        SliderFill.Size = UDim2.new(percent, 0, 1, 0)
        ValueLabel.Text = tostring(newValue) .. (suffix or "")
        value = newValue
        
        if callback then callback(newValue) end
    end
    
    Button.MouseButton1Down:Connect(function(input)
        dragging = true
        updateSlider(input)
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateSlider(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    return Frame
end

local function CreateDropdown(parent, name, options, default, callback)
    local Frame = Instance.new("Frame")
    Frame.Name = name .. "Dropdown"
    Frame.Size = UDim2.new(1, 0, 0, 45)
    Frame.BackgroundColor3 = Colors.Element
    Frame.BorderSizePixel = 0
    Frame.Parent = parent
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 6)
    Corner.Parent = Frame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.5, 0, 1, 0)
    Label.Position = UDim2.new(0, 15, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Colors.Text
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.TextSize = 14
    Label.Font = Enum.Font.Gotham
    Label.Parent = Frame
    
    local Dropdown = Instance.new("Frame")
    Dropdown.Name = "Dropdown"
    Dropdown.Size = UDim2.new(0.4, -15, 0, 30)
    Dropdown.Position = UDim2.new(0.6, 0, 0.5, -15)
    Dropdown.BackgroundColor3 = Colors.ElementHover
    Dropdown.BorderSizePixel = 0
    Dropdown.Parent = Frame
    
    local DropdownCorner = Instance.new("UICorner")
    DropdownCorner.CornerRadius = UDim.new(0, 6)
    DropdownCorner.Parent = Dropdown
    
    local SelectedLabel = Instance.new("TextLabel")
    SelectedLabel.Name = "Selected"
    SelectedLabel.Size = UDim2.new(1, -30, 1, 0)
    SelectedLabel.Position = UDim2.new(0, 10, 0, 0)
    SelectedLabel.BackgroundTransparency = 1
    SelectedLabel.Text = default or options[1]
    SelectedLabel.TextColor3 = Colors.Text
    SelectedLabel.TextXAlignment = Enum.TextXAlignment.Left
    SelectedLabel.TextSize = 14
    SelectedLabel.Font = Enum.Font.Gotham
    SelectedLabel.Parent = Dropdown
    
    local Arrow = Instance.new("TextLabel")
    Arrow.Name = "Arrow"
    Arrow.Size = UDim2.new(0, 20, 1, 0)
    Arrow.Position = UDim2.new(1, -25, 0, 0)
    Arrow.BackgroundTransparency = 1
    Arrow.Text = "▼"
    Arrow.TextColor3 = Colors.TextDim
    Arrow.TextSize = 12
    Arrow.Font = Enum.Font.Gotham
    Arrow.Parent = Dropdown
    
    local DropdownButton = Instance.new("TextButton")
    DropdownButton.Name = "Button"
    DropdownButton.Size = UDim2.new(1, 0, 1, 0)
    DropdownButton.BackgroundTransparency = 1
    DropdownButton.Text = ""
    DropdownButton.Parent = Dropdown
    
    local DropdownMenu = Instance.new("Frame")
    DropdownMenu.Name = "DropdownMenu"
    DropdownMenu.Size = UDim2.new(1, 0, 0, #options * 30 + 10)
    DropdownMenu.Position = UDim2.new(0, 0, 1, 5)
    DropdownMenu.BackgroundColor3 = Colors.Surface
    DropdownMenu.BorderSizePixel = 0
    DropdownMenu.Visible = false
    DropdownMenu.ZIndex = 10
    DropdownMenu.Parent = Dropdown
    
    local MenuCorner = Instance.new("UICorner")
    MenuCorner.CornerRadius = UDim.new(0, 6)
    MenuCorner.Parent = DropdownMenu
    
    local MenuLayout = Instance.new("UIListLayout")
    MenuLayout.SortOrder = Enum.SortOrder.LayoutOrder
    MenuLayout.Padding = UDim.new(0, 2)
    MenuLayout.Parent = DropdownMenu
    
    local MenuPadding = Instance.new("UIPadding")
    MenuPadding.PaddingLeft = UDim.new(0, 5)
    MenuPadding.PaddingRight = UDim.new(0, 5)
    MenuPadding.PaddingTop = UDim.new(0, 5)
    MenuPadding.PaddingBottom = UDim.new(0, 5)
    MenuPadding.Parent = DropdownMenu
    
    local value = default or options[1]
    
    for _, option in ipairs(options) do
        local OptionBtn = Instance.new("TextButton")
        OptionBtn.Name = option
        OptionBtn.Size = UDim2.new(1, 0, 0, 25)
        OptionBtn.BackgroundColor3 = Colors.Element
        OptionBtn.Text = "   " .. option
        OptionBtn.TextColor3 = Colors.Text
        OptionBtn.TextXAlignment = Enum.TextXAlignment.Left
        OptionBtn.TextSize = 14
        OptionBtn.Font = Enum.Font.Gotham
        OptionBtn.AutoButtonColor = false
        OptionBtn.ZIndex = 11
        OptionBtn.Parent = DropdownMenu
        
        local OptionCorner = Instance.new("UICorner")
        OptionCorner.CornerRadius = UDim.new(0, 4)
        OptionCorner.Parent = OptionBtn
        
        OptionBtn.MouseEnter:Connect(function()
            OptionBtn.BackgroundColor3 = Colors.ElementHover
        end)
        
        OptionBtn.MouseLeave:Connect(function()
            OptionBtn.BackgroundColor3 = Colors.Element
        end)
        
        OptionBtn.MouseButton1Click:Connect(function()
            SelectedLabel.Text = option
            value = option
            DropdownMenu.Visible = false
            if callback then callback(option) end
        end)
    end
    
    DropdownButton.MouseButton1Click:Connect(function()
        DropdownMenu.Visible = not DropdownMenu.Visible
    end)
    
    return Frame
end

local function CreateButton(parent, name, callback)
    local Button = Instance.new("TextButton")
    Button.Name = name .. "Button"
    Button.Size = UDim2.new(1, 0, 0, 35)
    Button.BackgroundColor3 = Colors.Accent
    Button.Text = "  " .. name
    Button.TextColor3 = Colors.Text
    Button.TextXAlignment = Enum.TextXAlignment.Left
    Button.TextSize = 14
    Button.Font = Enum.Font.GothamBold
    Button.AutoButtonColor = false
    Button.Parent = parent
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 6)
    ButtonCorner.Parent = Button
    
    Button.MouseEnter:Connect(function()
        Button.BackgroundColor3 = Colors.AccentHover
    end)
    
    Button.MouseLeave:Connect(function()
        Button.BackgroundColor3 = Colors.Accent
    end)
    
    Button.MouseButton1Click:Connect(function()
        if callback then callback() end
    end)
    
    return Button
end

local function CreateLabel(parent, text)
    local Label = Instance.new("TextLabel")
    Label.Name = "Label"
    Label.Size = UDim2.new(1, 0, 0, 25)
    Label.BackgroundTransparency = 1
    Label.Text = "  " .. text
    Label.TextColor3 = Colors.TextDim
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.TextSize = 13
    Label.Font = Enum.Font.Gotham
    Label.Parent = parent
    
    return Label
end

-- ============================================
-- CONFIGURATION
-- ============================================
local Config = {
    -- Silent Aim
    SilentAim = false,
    SilentFOV = 200,
    SilentPrediction = 0.13,
    SilentPart = "Head",
    SilentTeam = true,
    SilentVisible = true,
    
    -- Aimbot
    Aimbot = false,
    AimFOV = 150,
    AimSmooth = 0.2,
    AimPrediction = 0.13,
    AimPart = "Head",
    
    -- Triggerbot
    Triggerbot = false,
    TriggerFOV = 60,
    TriggerDelay = 0.025,
    
    -- Rapid Fire
    RapidFire = false,
    RapidFireDelay = 0.05,
    
    -- Hitbox
    HitboxExpander = false,
    HitboxSize = 21,
    HitboxTransparency = 6,
    HitboxNoCollision = false,
    HitboxTeamCheck = "FFA",
    
    -- ESP
    ESP = false,
    Box = false,
    Tracer = false,
    Head = false,
    Name = false,
    Distance = false,
    BoxColor = Color3.fromRGB(255,255,255),
    
    -- FOV
    FOV = false,
    FOVRadius = 150,
    
    -- Movement
    Walkspeed = false,
    WalkspeedValue = 32,
    Fly = false,
    FlySpeed = 50,
    InfJump = false,
    NoClip = false,
    
    -- Utility
    AutoReload = false,
    InfiniteRange = false,
    ClickTP = false
}

-- ============================================
-- CREATE TABS
-- ============================================
local SilentTab, SilentLayout = CreateTab("Silent Aim")
local AimbotTab, AimbotLayout = CreateTab("Aimbot")
local HitboxTab, HitboxLayout = CreateTab("Hitbox")
local VisualsTab, VisualsLayout = CreateTab("Visuals")
local MovementTab, MovementLayout = CreateTab("Movement")
local UtilityTab, UtilityLayout = CreateTab("Utility")
local InfoTab, InfoLayout = CreateTab("Info")

-- ============================================
-- SILENT AIM TAB
-- ============================================
local SilentSection1, _ = CreateSection(SilentTab, "Silent Aim Settings")
CreateToggle(SilentSection1, "Enable Silent Aim", false, function(v) Config.SilentAim = v end)
CreateDropdown(SilentSection1, "Target Part", {"Head", "UpperTorso", "LowerTorso", "HumanoidRootPart"}, "Head", function(v) Config.SilentPart = v end)
CreateSlider(SilentSection1, "FOV", 50, 400, 200, "px", function(v) Config.SilentFOV = v end)
CreateSlider(SilentSection1, "Prediction", 0, 300, 130, "ms", function(v) Config.SilentPrediction = v / 1000 end)
CreateToggle(SilentSection1, "Team Check", true, function(v) Config.SilentTeam = v end)
CreateToggle(SilentSection1, "Visible Check", true, function(v) Config.SilentVisible = v end)

-- ============================================
-- AIMBOT TAB
-- ============================================
local AimSection1, _ = CreateSection(AimbotTab, "Aimbot Settings")
CreateToggle(AimSection1, "Enable Aimbot", false, function(v) Config.Aimbot = v end)
CreateDropdown(AimSection1, "Target Part", {"Head", "UpperTorso", "LowerTorso", "HumanoidRootPart"}, "Head", function(v) Config.AimPart = v end)
CreateSlider(AimSection1, "FOV", 50, 300, 150, "px", function(v) Config.AimFOV = v end)
CreateSlider(AimSection1, "Smoothness", 0.05, 0.5, 0.2, "", function(v) Config.AimSmooth = v end)
CreateSlider(AimSection1, "Prediction", 0, 300, 130, "ms", function(v) Config.AimPrediction = v / 1000 end)

local TriggerSection, _ = CreateSection(AimbotTab, "Triggerbot")
CreateToggle(TriggerSection, "Enable Triggerbot", false, function(v) Config.Triggerbot = v end)
CreateSlider(TriggerSection, "Trigger FOV", 30, 150, 60, "px", function(v) Config.TriggerFOV = v end)
CreateSlider(TriggerSection, "Trigger Delay", 0, 100, 25, "ms", function(v) Config.TriggerDelay = v / 1000 end)

local RapidSection, _ = CreateSection(AimbotTab, "Rapid Fire")
CreateToggle(RapidSection, "Enable Rapid Fire", false, function(v) Config.RapidFire = v end)
CreateSlider(RapidSection, "Fire Rate", 10, 100, 50, "ms", function(v) Config.RapidFireDelay = v / 1000 end)

-- ============================================
-- HITBOX TAB
-- ============================================
local HitboxSection, _ = CreateSection(HitboxTab, "Hitbox Expander")
CreateToggle(HitboxSection, "Enable Hitbox Expander", false, function(v) Config.HitboxExpander = v; UpdateHitboxes() end)
CreateSlider(HitboxSection, "Hitbox Size", 5, 40, 21, "studs", function(v) Config.HitboxSize = v; UpdateHitboxes() end)
CreateSlider(HitboxSection, "Transparency", 0, 10, 6, "/10", function(v) Config.HitboxTransparency = v; UpdateHitboxes() end)
CreateToggle(HitboxSection, "Disable Collision", false, function(v) Config.HitboxNoCollision = v; UpdateHitboxes() end)
CreateDropdown(HitboxSection, "Team Check", {"FFA", "Everyone", "Enemies Only"}, "FFA", function(v) Config.HitboxTeamCheck = v; UpdateHitboxes() end)

-- ============================================
-- VISUALS TAB
-- ============================================
local ESPSection, _ = CreateSection(VisualsTab, "ESP Settings")
CreateToggle(ESPSection, "Enable ESP", false, function(v) Config.ESP = v end)
CreateToggle(ESPSection, "2D Box", false, function(v) Config.Box = v end)
CreateToggle(ESPSection, "Tracer", false, function(v) Config.Tracer = v end)
CreateToggle(ESPSection, "Head Dot", false, function(v) Config.Head = v end)
CreateToggle(ESPSection, "Name Tag", false, function(v) Config.Name = v end)
CreateToggle(ESPSection, "Distance", false, function(v) Config.Distance = v end)
CreateDropdown(ESPSection, "Box Color", {"White", "Red", "Green", "Blue", "Yellow"}, "White", function(v) 
    local colors = {White=Color3.fromRGB(255,255,255), Red=Color3.fromRGB(255,70,70), Green=Color3.fromRGB(70,255,70), Blue=Color3.fromRGB(70,70,255), Yellow=Color3.fromRGB(255,255,70)}
    Config.BoxColor = colors[v] 
end)

local FOVSection, _ = CreateSection(VisualsTab, "FOV Circle")
CreateToggle(FOVSection, "Show FOV Circle", false, function(v) Config.FOV = v end)
CreateSlider(FOVSection, "FOV Radius", 50, 300, 150, "px", function(v) Config.FOVRadius = v end)

-- ============================================
-- MOVEMENT TAB
-- ============================================
local SpeedSection, _ = CreateSection(MovementTab, "Speed")
CreateToggle(SpeedSection, "Walkspeed", false, function(v) Config.Walkspeed = v end)
CreateSlider(SpeedSection, "Walkspeed Value", 16, 100, 32, "studs", function(v) Config.WalkspeedValue = v end)

local FlySection, _ = CreateSection(MovementTab, "Flight")
CreateToggle(FlySection, "Enable Fly", false, function(v) Config.Fly = v; if v then StartFly() else StopFly() end end)
CreateSlider(FlySection, "Fly Speed", 20, 150, 50, "studs", function(v) Config.FlySpeed = v end)

local JumpSection, _ = CreateSection(MovementTab, "Jump")
CreateToggle(JumpSection, "Infinite Jump", false, function(v) Config.InfJump = v end)

local NoclipSection, _ = CreateSection(MovementTab, "Collision")
CreateToggle(NoclipSection, "NoClip", false, function(v) Config.NoClip = v end)

-- ============================================
-- UTILITY TAB
-- ============================================
local WeaponSection, _ = CreateSection(UtilityTab, "Weapon")
CreateToggle(WeaponSection, "Auto Reload", false, function(v) Config.AutoReload = v end)
CreateToggle(WeaponSection, "Infinite Range", false, function(v) Config.InfiniteRange = v end)

local CombatSection, _ = CreateSection(UtilityTab, "Combat")
CreateButton(CombatSection, "Kill All", function()
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            local h = p.Character:FindFirstChildOfClass("Humanoid")
            if h and h.Health > 0 then h.Health = 0 end
        end
    end
end)
CreateToggle(CombatSection, "Click Teleport", false, function(v) Config.ClickTP = v; SetupClickTP() end)

-- ============================================
-- INFO TAB
-- ============================================
local AboutSection, _ = CreateSection(InfoTab, "About")
CreateLabel(AboutSection, "ARC CLIENT | ARSENAL")
CreateLabel(AboutSection, "Developer: mqp6/developer")
CreateLabel(AboutSection, "Version: 10.1.0")
CreateLabel(AboutSection, "Build: 02/12/2026")
CreateLabel(AboutSection, " ")

local FeaturesSection, _ = CreateSection(InfoTab, "Features")
CreateLabel(FeaturesSection, "✓ Silent Aim - Working")
CreateLabel(FeaturesSection, "✓ Aimbot - Working")
CreateLabel(FeaturesSection, "✓ Triggerbot - Working")
CreateLabel(FeaturesSection, "✓ Rapid Fire - Working")
CreateLabel(FeaturesSection, "✓ Hitbox Expander - Working")
CreateLabel(FeaturesSection, "✓ ESP - Working")
CreateLabel(FeaturesSection, "✓ Fly - Working")
CreateLabel(FeaturesSection, "✓ Infinite Jump - Working")
CreateLabel(FeaturesSection, "✓ NoClip - Working")
CreateLabel(FeaturesSection, "✓ Auto Reload - Working")
CreateLabel(FeaturesSection, "✓ Infinite Range - Working")
CreateLabel(FeaturesSection, " ")

local DiscordSection, _ = CreateSection(InfoTab, "Community")
CreateButton(DiscordSection, "Copy Discord Invite", function()
    setclipboard("https://discord.gg/rmpQfYtnWd")
    StarterGui:SetCore("SendNotification", {
        Title = "ARC CLIENT",
        Text = "Discord link copied!",
        Duration = 2
    })
end)

-- ============================================
-- SELECT FIRST TAB
-- ============================================
SwitchTab(1)

-- ============================================
-- DRAWING SYSTEM
-- ============================================
local Drawings = {
    Pool = {},
    ESP = {},
    FOV = nil
}

local function CreateDrawing(t, p)
    local s, d = pcall(function() return Drawing.new(t) end)
    if s and d then
        for k, v in pairs(p or {}) do
            pcall(function() d[k] = v end)
        end
        table.insert(Drawings.Pool, d)
        return d
    end
    return nil
end

local function WorldToScreen(p)
    if not Camera then return Vector2.new(0, 0), 0, false end
    local v, vf = Camera:WorldToViewportPoint(p)
    return Vector2.new(v.X, v.Y), v.Z, vf
end

local function GetCenter()
    return Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
end

-- ============================================
-- PLAYER VALIDATION
-- ============================================
local function ValidatePlayer(p)
    if not p or p == LocalPlayer then return false end
    if not p.Character then return false end
    local c = p.Character
    local h = c:FindFirstChildOfClass("Humanoid")
    local r = c:FindFirstChild("HumanoidRootPart")
    return h and r and h.Health > 0
end

local function IsVisible(part)
    if not LocalPlayer.Character then return true end
    local rp = RaycastParams.new()
    rp.FilterType = Enum.RaycastFilterType.Exclude
    rp.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    rp.IgnoreWater = true
    local origin = Camera.CFrame.Position
    local dir = (part.Position - origin).Unit * 1000
    local result = Workspace:Raycast(origin, dir, rp)
    return result == nil or result.Instance:IsDescendantOf(part.Parent)
end

local function IsEnemy(player)
    if not Config.SilentTeam and not Config.Aimbot then return true end
    if not player.Team or not LocalPlayer.Team then return true end
    return player.Team ~= LocalPlayer.Team
end

-- ============================================
-- GET CLOSEST PLAYER
-- ============================================
local function GetClosestPlayer(fov, partName)
    local center = GetCenter()
    local closest, closestDist = nil, fov or 999
    
    for _, p in ipairs(Players:GetPlayers()) do
        if ValidatePlayer(p) and IsEnemy(p) then
            local part = p.Character:FindFirstChild(partName) or
                        p.Character:FindFirstChild("Head") or
                        p.Character:FindFirstChild("HumanoidRootPart")
            if part then
                if Config.SilentVisible and not IsVisible(part) then
                    local alt = p.Character:FindFirstChild("HumanoidRootPart")
                    if alt and IsVisible(alt) then
                        part = alt
                    else
                        continue
                    end
                end
                local pos, _, onScreen = WorldToScreen(part.Position)
                if onScreen then
                    local dist = (pos - center).Magnitude
                    if dist < closestDist then
                        closest = p
                        closestDist = dist
                    end
                end
            end
        end
    end
    return closest, closestDist
end

-- ============================================
-- SILENT AIM HOOK (WITH READONLY SAFETY)
-- ============================================
if success then
    mt.__namecall = newcclosure(function(self, ...)
        local args = {...}
        local method = getnamecallmethod()
        
        if Config.SilentAim and method == "FireServer" and not checkcaller() then
            local remote = tostring(self):lower()
            
            if remote:find("bullet") or remote:find("shoot") or remote:find("fire") or 
               remote:find("weapon") or remote:find("hit") or remote:find("damage") then
                
                local target = GetClosestPlayer(Config.SilentFOV, Config.SilentPart)
                
                if target and target.Character then
                    local part = target.Character:FindFirstChild(Config.SilentPart) or
                                target.Character:FindFirstChild("Head") or
                                target.Character:FindFirstChild("HumanoidRootPart")
                    
                    if part then
                        local vel = part.AssemblyLinearVelocity or Vector3.new(0,0,0)
                        local pos = part.Position + (vel * Config.SilentPrediction)
                        
                        for i = 1, #args do
                            if typeof(args[i]) == "Vector3" then
                                args[i] = pos
                            elseif typeof(args[i]) == "Instance" and args[i]:IsA("BasePart") then
                                args[i] = part
                            end
                        end
                    end
                end
            end
        end
        
        return oldNamecall(self, unpack(args))
    end)
end

-- ============================================
-- AIMBOT
-- ============================================
RunService.RenderStepped:Connect(function()
    if Config.Aimbot and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local target = GetClosestPlayer(Config.AimFOV, Config.AimPart)
        if target and target.Character then
            local part = target.Character:FindFirstChild(Config.AimPart) or
                        target.Character:FindFirstChild("Head") or
                        target.Character:FindFirstChild("HumanoidRootPart")
            if part then
                local vel = part.AssemblyLinearVelocity or Vector3.new(0,0,0)
                local pos, onScreen = WorldToScreen(part.Position + (vel * Config.AimPrediction))
                if onScreen then
                    local delta = pos - GetCenter()
                    mousemoverel(delta.X * Config.AimSmooth, delta.Y * Config.AimSmooth)
                end
            end
        end
    end
end)

-- ============================================
-- TRIGGERBOT
-- ============================================
local lastTrigger = 0
RunService.RenderStepped:Connect(function()
    if Config.Triggerbot then
        local now = tick()
        if now - lastTrigger < Config.TriggerDelay then return end
        local target = GetClosestPlayer(Config.TriggerFOV, "Head")
        if target then
            mouse1press()
            task.wait(0.01)
            mouse1release()
            lastTrigger = now
        end
    end
end)

-- ============================================
-- RAPID FIRE
-- ============================================
local lastRapid = 0
RunService.RenderStepped:Connect(function()
    if Config.RapidFire and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
        local now = tick()
        if now - lastRapid < Config.RapidFireDelay then return end
        mouse1press()
        task.wait(0.01)
        mouse1release()
        lastRapid = now
    end
end)

-- ============================================
-- HITBOX EXPANDER
-- ============================================
local HitboxDatabase = {}
local HitboxParts = {
    "Head", "UpperTorso", "LowerTorso",
    "LeftUpperArm", "RightUpperArm", "LeftLowerArm", "RightLowerArm",
    "LeftUpperLeg", "RightUpperLeg", "LeftLowerLeg", "RightLowerLeg"
}

local function SaveOriginal(player, part)
    if not HitboxDatabase[player] then HitboxDatabase[player] = {} end
    if not HitboxDatabase[player][part.Name] then
        HitboxDatabase[player][part.Name] = {
            Size = part.Size,
            CanCollide = part.CanCollide,
            Transparency = part.Transparency
        }
    end
end

local function RestoreOriginal(player)
    if HitboxDatabase[player] then
        for name, props in pairs(HitboxDatabase[player]) do
            local part = player.Character and player.Character:FindFirstChild(name)
            if part and part:IsA("BasePart") then
                part.Size = props.Size
                part.CanCollide = props.CanCollide
                part.Transparency = props.Transparency
            end
        end
        HitboxDatabase[player] = nil
    end
end

function UpdateHitboxes()
    if not Config.HitboxExpander then
        for p, _ in pairs(HitboxDatabase) do RestoreOriginal(p) end
        return
    end
    
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            if Config.HitboxTeamCheck == "FFA" or Config.HitboxTeamCheck == "Everyone" or IsEnemy(p) then
                for _, name in ipairs(HitboxParts) do
                    local part = p.Character:FindFirstChild(name)
                    if part and part:IsA("BasePart") then
                        SaveOriginal(p, part)
                        part.Size = Vector3.new(Config.HitboxSize, Config.HitboxSize, Config.HitboxSize)
                        part.CanCollide = not Config.HitboxNoCollision
                        part.Transparency = Config.HitboxTransparency / 10
                    end
                end
            else
                RestoreOriginal(p)
            end
        end
    end
end

RunService.RenderStepped:Connect(UpdateHitboxes)

-- ============================================
-- ESP RENDER
-- ============================================
local function RenderESP()
    if not Config.ESP then
        for _, esp in pairs(Drawings.ESP) do
            for _, d in pairs(esp) do pcall(function() d.Visible = false end) end
        end
        return
    end
    
    for _, p in ipairs(Players:GetPlayers()) do
        if ValidatePlayer(p) then
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            local pos, depth, onScreen = WorldToScreen(root.Position)
            if onScreen and depth > 0 then
                local esp = Drawings.ESP[p]
                if not esp then
                    esp = {}
                    esp.Box = CreateDrawing("Square", { Thickness = 1, Color = Config.BoxColor, Filled = false, Visible = false })
                    esp.BoxOutline = CreateDrawing("Square", { Thickness = 2, Color = Color3.fromRGB(0,0,0), Filled = false, Visible = false })
                    esp.Name = CreateDrawing("Text", { Text = p.Name, Color = Color3.fromRGB(255,255,255), Size = 13, Center = true, Outline = true, OutlineColor = Color3.fromRGB(0,0,0), Visible = false })
                    esp.Head = CreateDrawing("Circle", { Radius = 2.5, Filled = true, Color = Color3.fromRGB(255,255,255), Transparency = 0.2, NumSides = 16, Visible = false })
                    esp.Tracer = CreateDrawing("Line", { Thickness = 1, Color = Config.BoxColor, Visible = false })
                    esp.Distance = CreateDrawing("Text", { Text = "0M", Color = Color3.fromRGB(200,200,200), Size = 11, Center = true, Outline = true, OutlineColor = Color3.fromRGB(0,0,0), Visible = false })
                    Drawings.ESP[p] = esp
                end
                
                local scale = math.clamp(650 / (depth + 0.1) * 0.65, 0.45, 0.9)
                local w = math.floor(22 * scale)
                local h = math.floor(44 * scale)
                local x, y = pos.X, pos.Y
                
                if Config.Box then
                    esp.Box.Position = Vector2.new(x - w/2, y - h/2)
                    esp.Box.Size = Vector2.new(w, h)
                    esp.Box.Visible = true
                    esp.BoxOutline.Position = Vector2.new(x - w/2 - 1, y - h/2 - 1)
                    esp.BoxOutline.Size = Vector2.new(w + 2, h + 2)
                    esp.BoxOutline.Visible = true
                else
                    if esp.Box then esp.Box.Visible = false end
                    if esp.BoxOutline then esp.BoxOutline.Visible = false end
                end
                
                if Config.Tracer and esp.Tracer then
                    esp.Tracer.From = GetCenter()
                    esp.Tracer.To = Vector2.new(x, y)
                    esp.Tracer.Visible = true
                elseif esp.Tracer then esp.Tracer.Visible = false end
                
                if Config.Head and p.Character:FindFirstChild("Head") and esp.Head then
                    local hp = WorldToScreen(p.Character.Head.Position)
                    esp.Head.Position = hp
                    esp.Head.Visible = true
                elseif esp.Head then esp.Head.Visible = false end
                
                if Config.Name and esp.Name then
                    esp.Name.Position = Vector2.new(x, y - h/2 - 16)
                    esp.Name.Text = string.upper(p.Name)
                    esp.Name.Visible = true
                elseif esp.Name then esp.Name.Visible = false end
                
                if Config.Distance and esp.Distance and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    local dist = math.floor((LocalPlayer.Character.HumanoidRootPart.Position - root.Position).Magnitude)
                    esp.Distance.Position = Vector2.new(x, y + h/2 + 14)
                    esp.Distance.Text = dist .. "M"
                    esp.Distance.Visible = true
                elseif esp.Distance then esp.Distance.Visible = false end
            end
        end
    end
end

RunService.RenderStepped:Connect(RenderESP)

-- ============================================
-- FOV CIRCLE
-- ============================================
RunService.RenderStepped:Connect(function()
    if Config.FOV then
        if not Drawings.FOV then
            Drawings.FOV = CreateDrawing("Circle", {
                Radius = Config.FOVRadius,
                Color = Color3.fromRGB(255,255,255),
                Thickness = 1.5,
                Filled = false,
                NumSides = 64,
                Visible = true,
                Position = GetCenter()
            })
        else
            Drawings.FOV.Position = GetCenter()
            Drawings.FOV.Radius = Config.FOVRadius
            Drawings.FOV.Visible = true
        end
    elseif Drawings.FOV then
        Drawings.FOV.Visible = false
    end
end)

-- ============================================
-- FLY SYSTEM
-- ============================================
local FlyActive = false
local FlyBV = nil
local FlyKeys = { W = false, S = false, A = false, D = false, Space = false, Shift = false }

function StartFly()
    if not LocalPlayer.Character then return end
    local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if not root or not hum then return end
    hum.PlatformStand = true
    FlyBV = Instance.new("BodyVelocity")
    FlyBV.Velocity = Vector3.new(0,0,0)
    FlyBV.MaxForce = Vector3.new(10000,10000,10000)
    FlyBV.P = 1000
    FlyBV.Parent = root
    FlyActive = true
end

function StopFly()
    if FlyBV then FlyBV:Destroy() FlyBV = nil end
    if LocalPlayer and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.PlatformStand = false end
    end
    FlyActive = false
end

UserInputService.InputBegan:Connect(function(i, g)
    if g then return end
    if i.KeyCode == Enum.KeyCode.W then FlyKeys.W = true end
    if i.KeyCode == Enum.KeyCode.S then FlyKeys.S = true end
    if i.KeyCode == Enum.KeyCode.A then FlyKeys.A = true end
    if i.KeyCode == Enum.KeyCode.D then FlyKeys.D = true end
    if i.KeyCode == Enum.KeyCode.Space then FlyKeys.Space = true end
    if i.KeyCode == Enum.KeyCode.LeftShift then FlyKeys.Shift = true end
end)

UserInputService.InputEnded:Connect(function(i, g)
    if g then return end
    if i.KeyCode == Enum.KeyCode.W then FlyKeys.W = false end
    if i.KeyCode == Enum.KeyCode.S then FlyKeys.S = false end
    if i.KeyCode == Enum.KeyCode.A then FlyKeys.A = false end
    if i.KeyCode == Enum.KeyCode.D then FlyKeys.D = false end
    if i.KeyCode == Enum.KeyCode.Space then FlyKeys.Space = false end
    if i.KeyCode == Enum.KeyCode.LeftShift then FlyKeys.Shift = false end
end)

RunService.Heartbeat:Connect(function()
    if Config.Fly and FlyActive and FlyBV then
        local cam = Workspace.CurrentCamera
        local move = Vector3.new()
        if FlyKeys.W then move = move + cam.CFrame.LookVector end
        if FlyKeys.S then move = move - cam.CFrame.LookVector end
        if FlyKeys.A then move = move - cam.CFrame.RightVector end
        if FlyKeys.D then move = move + cam.CFrame.RightVector end
        if FlyKeys.Space then move = move + Vector3.new(0, 1, 0) end
        if FlyKeys.Shift then move = move - Vector3.new(0, 1, 0) end
        if move.Magnitude > 0 then
            FlyBV.Velocity = move.Unit * Config.FlySpeed
        else
            FlyBV.Velocity = Vector3.new(0,0,0)
        end
    end
end)

-- ============================================
-- INFINITE JUMP
-- ============================================
UserInputService.JumpRequest:Connect(function()
    if Config.InfJump and LocalPlayer and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
    end
end)

-- ============================================
-- NOCLIP
-- ============================================
local NoclipConnection = nil
local function StartNoClip()
    if NoclipConnection then NoclipConnection:Disconnect() end
    NoclipConnection = RunService.Stepped:Connect(function()
        if Config.NoClip and LocalPlayer and LocalPlayer.Character then
            for _, p in ipairs(LocalPlayer.Character:GetDescendants()) do
                if p:IsA("BasePart") then p.CanCollide = false end
            end
        end
    end)
end
StartNoClip()

-- ============================================
-- AUTO RELOAD
-- ============================================
local lastReload = 0
RunService.Heartbeat:Connect(function()
    if Config.AutoReload then
        local now = tick()
        if now - lastReload < 1 then return end
        if LocalPlayer and LocalPlayer.Character then
            local tool = LocalPlayer.Character:FindFirstChildOfClass("Tool")
            if tool then
                local ammo = tool:FindFirstChild("Ammo") or tool:FindFirstChild("CurrentAmmo")
                if ammo and tonumber(ammo.Value) and tonumber(ammo.Value) <= 0 then
                    local remote = ReplicatedStorage:FindFirstChild("Reload") or ReplicatedStorage:FindFirstChild("ReloadRemote")
                    if remote and remote:IsA("RemoteEvent") then
                        remote:FireServer()
                        lastReload = now
                    end
                end
            end
        end
    end
end)

-- ============================================
-- INFINITE RANGE (WITH READONLY SAFETY)
-- ============================================
if success then
    mt.__index = newcclosure(function(self, k)
        if Config.InfiniteRange and not checkcaller() then
            if k == "MaxRange" or k == "Range" or k == "BulletRange" then return 9999 end
        end
        return oldIndex(self, k)
    end)
end

-- ============================================
-- WALKSPEED
-- ============================================
RunService.RenderStepped:Connect(function()
    if LocalPlayer and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = Config.Walkspeed and Config.WalkspeedValue or 16
        end
    end
end)

-- ============================================
-- CLICK TELEPORT
-- ============================================
local ClickTPConnection = nil
function SetupClickTP()
    if ClickTPConnection then ClickTPConnection:Disconnect() end
    if Config.ClickTP then
        ClickTPConnection = Mouse.Button1Down:Connect(function()
            if LocalPlayer and LocalPlayer.Character then
                local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if root then
                    local target = Mouse.Hit
                    if target then
                        root.CFrame = CFrame.new(target.X, target.Y + 3, target.Z)
                    end
                end
            end
        end)
    end
end

-- ============================================
-- NOTIFICATION
-- ============================================
StarterGui:SetCore("SendNotification", {
    Title = "ARC CLIENT",
    Text = "Custom UI Loaded • Silent Aim: " .. (success and "ON" or "OFF (Metatable failed)"),
    Duration = 5
})
